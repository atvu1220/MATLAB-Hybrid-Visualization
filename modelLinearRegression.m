%Linear Regression Model
%For fitting Model with maxUz per time for each parameter
load('/import/c1/DAYSIDE/atvu/RunsOutput120_12072021.mat')
cutTime = 20;
Data = [];
va = 48.95;
for cutTime = [8:20]
Data = [Data;...
    fs25.maxU(cutTime,:)./va, 0.025, 20, 10, sind(125/180*090), 08,cutTime./2;...
    fs45.maxU(cutTime,:)./va, 0.045, 20, 10, sind(125/180*090), 08,cutTime./2;...
      fs6.maxU(cutTime,:)./va, 0.060, 20, 10, sind(125/180*090), 08,cutTime./2;...
      fs8.maxU(cutTime,:)./va, 0.080, 20, 10, sind(125/180*090), 08,cutTime./2;...
    fs105.maxU(cutTime,:)./va, 0.105, 20, 10, sind(125/180*090), 08,cutTime./2;...
     fs12.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 08,cutTime./2;...
     fs14.maxU(cutTime,:)./va, 0.140, 20, 10, sind(125/180*090), 08,cutTime./2;...
    fs165.maxU(cutTime,:)./va, 0.165, 20, 10, sind(125/180*090), 08,cutTime./2;...
     fs18.maxU(cutTime,:)./va, 0.180, 20, 10, sind(125/180*090), 08,cutTime./2;...
     SWv6.maxU(cutTime,:)./va, 0.120, 20, 06, sind(125/180*090), 08,cutTime./2;...
     SWv8.maxU(cutTime,:)./va, 0.120, 20, 08, sind(125/180*090), 08,cutTime./2;...
    SWv12.maxU(cutTime,:)./va, 0.120, 20, 12, sind(125/180*090), 08,cutTime./2;...
    SWv14.maxU(cutTime,:)./va, 0.120, 20, 14, sind(125/180*090), 08,cutTime./2;...
    SWv16.maxU(cutTime,:)./va, 0.120, 20, 16, sind(125/180*090), 08,cutTime./2;...
%        M6.maxU(cutTime,:)./va, 0.120, 12, 06, sind(2/3*090), 08,cutTime./2;...
%        M8.maxU(cutTime,:)./va, 0.120, 16, 08, sind(2/3*090), 08,cutTime./2;...
%       M10.maxU(cutTime,:)./va, 0.120, 20, 10, sind(2/3*090), 08,cutTime./2;...
%       M12.maxU(cutTime,:)./va, 0.120, 24, 12, sind(2/3*090), 08,cutTime./2;...
%       M14.maxU(cutTime,:)./va, 0.120, 28, 14, sind(2/3*090), 08,cutTime./2;...
%       M16.maxU(cutTime,:)./va, 0.120, 32, 16, sind(2/3*090), 08,cutTime./2;...
    FSv09.maxU(cutTime,:)./va, 0.120, 09, 10, sind(125/180*090), 08,cutTime./2;...
    FSv12.maxU(cutTime,:)./va, 0.120, 12, 10, sind(125/180*090), 08,cutTime./2;...
    FSv16.maxU(cutTime,:)./va, 0.120, 16, 10, sind(125/180*090), 08,cutTime./2;...
    FSv20.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 08,cutTime./2;...
    FSv24.maxU(cutTime,:)./va, 0.120, 24, 10, sind(125/180*090), 08,cutTime./2;...
    FSv28.maxU(cutTime,:)./va, 0.120, 28, 10, sind(125/180*090), 08,cutTime./2;...
     fsT2.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 02,cutTime./2;...
     fsT3.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 03,cutTime./2;...
     fsT4.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 04,cutTime./2;...
     fsT5.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 05,cutTime./2;...
     fsT6.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 06,cutTime./2;...
     fsT7.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 07,cutTime./2;...
     fsT8.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 08,cutTime./2;...
     fsT9.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 09,cutTime./2;...
    fsT10.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 10,cutTime./2;...
      d15.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*015), 08,cutTime./2;...
      d30.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*030), 08,cutTime./2;...
      d45.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*045), 08,cutTime./2;...
      d60.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*060), 08,cutTime./2;...
      d75.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*075), 08,cutTime./2;...
      d90.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*090), 08,cutTime./2;...
     d105.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*105), 08,cutTime./2;...
     d120.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*120), 08,cutTime./2;...
     d135.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*135), 08,cutTime./2;...
     d150.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*150), 08,cutTime./2;...
     d165.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*165), 08,cutTime./2;...
     d180.maxU(cutTime,:)./va, 0.120, 20, 10, sind(125/180*180), 08,cutTime./2;...
];

end
X = circshift(Data,-1,2);

X = array2table(X,'VariableNames',{'nfs','vfspara','vswpara','shear','vfsperp','DeltaT','ExpSpeed'});
x=X;
y  = x(:,end);
x(:,6) = [];


mdl = fitlm(X,'ExpSpeed ~ DeltaT:nfs:shear:vfspara + DeltaT:nfs:shear:vswpara +  DeltaT:nfs:vfsperp ');

% mdl = fitlm(X,'ExpSpeed ~ nfs:shear:vfspara + nfs:shear:vswpara +  nfs:vfsperp ');
mdl.disp
% %RMSE .329


% mdl = fitlm(X,'ExpSpeed ~ DeltaT:DeltaT:nfs:nfs:shear:shear:vfspara:vfspara + DeltaT:DeltaT:nfs:nfs:shear:shear:vswpara:vswpara +  DeltaT:DeltaT:nfs:nfs:vfsperp:vfsperp  -1');
% %RMSE all between 0.5 and 1.5...

% mdl = fitlm(X,'ExpSpeed ~ DeltaT:DeltaT:nfs:nfs:shear:shear:vfspara:vfspara + DeltaT:DeltaT:nfs:nfs:shear:shear:vswpara:vswpara +  DeltaT:DeltaT:nfs:nfs:vfsperp:vfsperp  -1');
% %RMSE all between 0.5 and 1.5...

%%mdl = fitlm(X,'ExpSpeed ~ DeltaT:nfs:shear:vfspara + DeltaT:DeltaT:nfs:shear:vswpara +  DeltaT:DeltaT:nfs:vfsperp  -1');
%T^2

%mdl = fitlm(X,'ExpSpeed ~ DeltaT:nfs:shear:vfspara + DeltaT:nfs:shear:vswpara +  DeltaT:nfs:vfsperp  -1');

%mdl = fitlm(X,'ExpSpeed ~ nfs:vfspara + nfs:vswpara +  nfs:vfsperp  -1');

% mdl = fitlm(X,'ExpSpeed ~ DeltaT:nfs:shear:vfspara + DeltaT:nfs:shear:vswpara + DeltaT:DeltaT:nfs:nfs:vfsperp   -1')
%RMSE .306, flat porfiles for all parameters <2.0 slopes, besides thermal

% mdl = fitlm(X,'ExpSpeed ~ DeltaT:DeltaT:nfs:shear:vfspara + DeltaT:DeltaT:nfs:shear:vswpara + DeltaT:DeltaT:nfs:vfsperp   -1')
%RMSE .384, flat porfiles for all parameters <2.0 slopes

% mdl = fitlm(X,'ExpSpeed ~ DeltaT:nfs:nfs:shear:shear:vfspara:vfspara + DeltaT:nfs:nfs:shear:shear:vswpara:vswpara + DeltaT:DeltaT:nfs:nfs:vfsperp:vfsperp   -1')
% %RMSE .319


% mdl = stepwiselm(X,'ExpSpeed ~ DeltaT:DeltaT:nfs:shear:vfspara + DeltaT:DeltaT:nfs:shear:vswpara + DeltaT:DeltaT:nfs:vfsperp   -1',...
%     'ResponseVar','ExpSpeed','PredictorVars',{'nfs','vfspara','vswpara','shear','vfsperp','DeltaT'})

% mdl = stlm(X,'Robostopts','on')

% anova(mdl)

% plotDiagnostics(mdl,'cookd')
% [~,larg] = max(mdl.Diagnostics.CooksDistance);
% mdl2 = fitlm(X,'ExpSpeed ~ nfs:shear:vfspara + nfs:shear:vswpara + nfs:vfsperp-1','Exclude',larg)

figure
plotEffects(mdl)

figure
plotSlice(mdl)
% figure
% plotInteraction(mdl,'nfs','vfspara')
% figure
% plotInteraction(mdl,'nfs','vswpara')
% figure
% plotInteraction(mdl,'vfspara','shear')
% 
% figure
% plotInteraction(mdl,'vfspara','shear','predictions')
% figure;
% plotInteraction(mdl,'shear','vfspara','predictions')

figure;
plot(mdl)
